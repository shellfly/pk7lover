{% extends 'basic.html' %}
{% block content %}
  {% if perm_err %}
    <p class="error_msg">
      Sorry,but you have no permission to view these photos
    </p>
  {% else %}

    <div class="modal" id="deleteModal" style="display:none">
      <div class="modal-header">
        <a class="close" data-dismiss="modal">×</a>
        <h4>删除相册 {{ gallery.name }}</h4>
      </div>
      <div class="modal-body">
        <p><strong>所有此相册相关的信息都将被删除！</strong>确定删除？</p>
      </div>
      <div class="modal-footer">
        <button class="btn" data-dismiss="modal" aria-hidden="true">取消</button>
        <a href="delete" class="btn btn-primary">删除</a>
      </div>
    </div>

    <div class="modal" id="editModal" style="display:none">
      <div class="modal-header">
        <a class="close" data-dismiss="modal">×</a>
        <h4>修改相册属性 {{ gallery.name }}</h4>
      </div>
      <div class="modal-body">
        
        <form action="{% url 7property_album gallery.id %}" method="POST" class="form-inline">
          {%csrf_token%}
          <label>权限:</label>
          <input type="radio" id="id_permission_0" value="0"
                 name="permission">公开
          <input type="radio" id="id_permission_1" value="1"
                 name="permission">仅朋友
          
          <input type="radio" id="id_permission_2" value="2"
                 name="permission">仅家人
          <br />
          <br />
          <label>是否允许评论:</label>
          <input type="radio" name="comment" value="yes"
          id="id_comment">是
          <input type="radio" name="comment" value="no"
          id="id_comment">否
          </div>
          <div class="modal-footer">
            <button class="btn" data-dismiss="modal" aria-hidden="true">取消</button>
            <button type="submit" class="btn btn-primary">确认</button>
          </div>
        </form>
      </div>
        
        <div class="row">
          <div class="utility span7">
            <ul>
              {% if not OTHER %}
                <li><a href="{% url 7upload_photo gallery.id %}"> <button class="btn btn-small">上传照片</button></a></li>
                <li><a data-toggle="modal" href="#editModal"> <button class="btn btn-small">修改属性</button></a></li>
                <li><a href="{% url 7albums people.username %}"><button class="btn btn-small">我的所有相册</button></a></li>
              {% else %}
                <li><a href="{% url 7albums people.username %}"><button class="btn btn-small">
                  {% firstof people.first_name people.username %}的所有相册</button>
                </a>
                </li>
              {% endif %}
            </ul>
          </div>

          <div class="pull-right">
            <p class="muted"><strong>{{gallery.name}}</strong> <small>创建于{{gallery.create_date|date:'Y-m-d'}} 
            {% if not OTHER %}
              <a  data-toggle="modal" href="#deleteModal">
                删除相册
              </a>
            {% endif %}</small></p>
          </div>
        </div>

        <div class="7photo-boxs">
          {% for photo in photos %}
            <div class="span2 7photo-box" style="margin-bottom:7px;background: #F2F0F0;">
              <div class="7photo-image img-polaroid" style="border:1px solid #DDD">
                <a href="/albums/photos/{{ photo.id }}">
                <img src="{{MEDIA_URL}}{{ photo.thumb128 }}" /></a>
              </div>
              <div class="7photo-desc" style="padding:5px 4px 0px;border:1px solid #DDD" >
                <p><small>{{photo.desc}}</small></p>
              </div>
            </div>
          {% endfor %}
        </div>


        
        <nav id="7page-nav" style="display:none">
          {# infinite scroll's next page must have a '2'!!!#}
          <span class="7page-prev">
            {% if not pp < 1 %}
              <a href="?p={{pp}}">前一页</a>
            {% else %}
              前一页
            {% endif %}
          </span>

          <span class="7page-next" >
            {% if np < sum_pages|add:"1"%}
              <a href="?p={{np}}">后一页</a>
            {% else %}后一页
          {% endif %}
          </span>   
        </nav>
        <script src="{{STATIC_URL}}js/jquery.infinitescroll.min.js"></script>
        <script>
          $(function(){
          var $photoboxs = $('.7photo-boxs')
          $photoboxs.infinitescroll({
          navSelector  : 'span.7page-next',    // selector for the paged navigation
          nextSelector : 'span.7page-next a',  // selector for the NEXT link (to page 2)
          itemSelector : '.7photo-box',     // selector for all items you'll retrieve
          debug:true,
          loading: {
          finishedMsg: 'No more pages to load.',
          msgText: "<em>Loading the next set of photos...</em>",
          img: 'http://i.imgur.com/6RMhx.gif'
          }},
          
          // trigger Masonry as a callback
          function( newElements ) {
          // hide new items while they are loading
          var $newElems = $( newElements ).css({ opacity: 0 });
          // ensure that images load before adding to masonry layout
          $newElems.imagesLoaded(function(){
          // show elems now they're ready
          $newElems.animate({ opacity: 1 });
          $photoboxs.masonry( 'appended', $newElems, true );
          });
          });
          });
        </script>

      {% endif %}

    {% endblock content %}
